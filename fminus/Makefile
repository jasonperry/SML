# Makefile for fminus; based on 'lexyacc' and 'units' examples

MOSMLHOME=/usr/share/mosml
MOSMLTOOLS=camlrunm $(MOSMLHOME)/tools
MOSMLC=mosmlc -c
MOSMLL=mosmlc	 # linker command
MOSMLLEX=mosmllex
MOSMLYACC=mosmlyac

UNITS= -structure Fmparse Fmtypes Fmlexer -toplevel Symtable Fmabsyn Pmain

all: Symtable.uo Fmabsyn.uo Fmlexer.uo Fmparse.uo Fmtypes.uo Pmain.uo fmc
#	mosml load

Fmparse.sml Fmparse.sig: Fmparse.grm
	$(MOSMLYACC) Fmparse.grm

.SUFFIXES :
.SUFFIXES : .sml .sig .ui .uo .mlp .lex .c .o

# general rules for converting files with one extension to another. 
.sig.ui:
	$(MOSMLC) $<

# this one needs to be in toplevel mode
#Symtable.uo: Symtable.sml
#	$(MOSMLC) -toplevel Symtable.sml

# these rules are only needed if UNITS is undefined or empty
.sml.uo:
	$(MOSMLC) $<

.lex.sml:
	$(MOSMLLEX) $<

fmc:	Pmain.uo
	$(MOSMLL) -o fmc Pmain.uo

depend: # Fmlexer.sml Fmparse.sml 
	rm -f Makefile.bak
	mv Makefile Makefile.bak
	$(MOSMLTOOLS)/cutdeps < Makefile.bak > Makefile
	$(MOSMLTOOLS)/mosmldep $(UNITS) >> Makefile

clean:
	rm -f Fmparse.sig Fmparse.sml Fmlexer.sml
	rm -f *.ui *.uo
	rm -f fmc
	rm -f Makefile.bak

# Generated by mosmldep (but modified)
### DO NOT DELETE THIS LINE
Fmparse.ui: Fmparse.sig 
	$(MOSMLC) -structure Fmparse.sig 
Fmparse.uo: Fmparse.sml Fmparse.ui 
	$(MOSMLC) -structure Fmparse.sml 
Fmtypes.uo: Fmtypes.sml Fmparse.ui 
	$(MOSMLC) -structure Fmparse.ui Fmtypes.sml 
Fmlexer.uo: Fmlexer.sml Fmtypes.uo 
	$(MOSMLC) -structure Fmtypes.ui Fmparse.ui Fmlexer.sml 
Symtable.uo: Symtable.sml # CHANGED
	$(MOSMLC) -toplevel Symtable.sml 
Fmabsyn.uo: Fmabsyn.sml Symtable.uo # CHANGED
	$(MOSMLC) -toplevel Symtable.ui Fmabsyn.sml 
Pmain.uo: Pmain.sml Fmabsyn.uo 
	$(MOSMLC) -toplevel Fmabsyn.ui Symtable.ui Fmlexer.ui Fmtypes.ui \
    Fmparse.ui Pmain.sml 
